<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nagi Plus-Demon Slayer</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            scroll-behavior: smooth;
        }

        .header {
            height: 300px;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .content {
            padding: 20px;
        }

        .details h1 {
            font-size: 24px;
            margin: 10px 0;
        }

        .details p {
            margin: 5px 0;
        }

        .buttons {
            margin: 10px 0;
            display: flex;
            gap: 10px;
        }

        .btn-lang, .btn-subtitles, .btn-episode, .btn-download {
            background-color: #333;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }

        .btn-download {
            background-color: #FFD700; /* Dorado */
            color: black; /* Texto negro */
            margin-left: auto;
            position: relative;
            overflow: hidden;
        }

        .btn-download::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.3);
            transition: left 0.5s;
        }

        .btn-download:hover::before {
            left: 100%;
        }

        .season-list, .episode-list {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .season-item, .episode-item {
            background-color: #444;
            padding: 10px;
            cursor: pointer;
            text-align: center;
            width: 100px;
            position: relative;
            transition: background-color 0.3s, color 0.3s;
        }

        .episode-item.selected, .season-item.selected {
            background-color: white;
            color: black;
        }

        .episodes {
            display: none;
        }

        .episode-item::before {
            content: attr(data-label);
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 8px;
            color: white;
            background-color: #34568B;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="header" id="videoSection">
        <iframe id="videoPlayer" src="https://www.example.com"></iframe> <!-- URL inicial -->
    </div>
    <div class="content">
        <div class="details">
            <h1>Demon Slayer: Kimetsu no Yaiba</h1>
            <p>Publicado: 2019 | Acción | Aventura | Fantasía</p>
            <p>Sinopsis: En el Japón Taisho, Tanjiro Kamado es un joven amable que vive con su familia en las montañas. Todo cambia cuando su familia es atacada por demonios, convirtiéndose en un asesino de demonios para vengar a su familia y curar a su hermana Nezuko, que ha sido transformada en demonio.</p>
            <div class="buttons">
                <button class="btn-lang">Idiomas</button>
                <button class="btn-subtitles">Selecciona un capítulo</button>
                <button class="btn-episode">Selecciona un capítulo</button>
                <button class="btn-download">Descargar</button> <!-- Botón de descarga -->
            </div>
            <div class="seasons">
                <h3>Temporadas</h3>
                <div class="season-list">
                    <div class="season-item" data-season="1">Temporada 1</div>
                    <div class="season-item" data-season="2">Temporada 2</div>
                    <div class="season-item" data-season="3">Temporada 3</div>
                    <div class="season-item" data-season="4">Temporada 4</div>
                </div>
            </div>
            <div class="episodes" id="episodesSection" style="display: none;">
                <h3>Capítulos</h3>
                <div class="episode-list">
                    <!-- Capítulos se mostrarán aquí -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const seasonItems = document.querySelectorAll('.season-item');
        const episodeList = document.querySelector('.episode-list');
        const episodesSection = document.getElementById('episodesSection');
        const videoPlayer = document.getElementById('videoPlayer');
        const videoSection = document.getElementById('videoSection');
        const episodeButton = document.querySelector('.btn-episode');
        const subtitlesButton = document.querySelector('.btn-subtitles');
        const downloadButton = document.querySelector('.btn-download');

        const capítulos = [
            { temporada: 1, episodios: Array.from({length: 26}, (_, i) => `Episodio ${i + 1}`) },
            { temporada: 2, episodios: Array.from({length: 18}, (_, i) => `Episodio ${i + 1}`) },
            { temporada: 3, episodios: Array.from({length: 11}, (_, i) => `Episodio ${i + 1}`) },
            { temporada: 4, episodios: Array.from({length: 8}, (_, i) => `Episodio ${i + 1}`) }
        ];

        // URLs de visualización de los episodios por temporada
        const urlsVisualización = {
            1: [
                'https://ryderjet.com/embed/90mwgra8u8ij',
                'https://ryderjet.com/embed/4phv9h77dzch',
                'https://example.com/view/season1/episode3.html',
                // ... más URLs para otros capítulos de la temporada 1
            ],
            2: [
                'https://ryderjet.com/embed/vftag6e6wk4k',
                'https://example.com/view/season2/episode2.html',
                'https://example.com/view/season2/episode3.html',
                // ... más URLs para otros capítulos de la temporada 2
            ],
            3: [
                'https://ryderjet.com/embed/krd4ddpdlzjw',
                'https://example.com/view/season3/episode2.html',
                'https://example.com/view/season3/episode3.html',
                // ... más URLs para otros capítulos de la temporada 3
            ],
            4: [
                'https://ryderjet.com/embed/5uio5usvgsjg',
                'https://example.com/view/season4/episode2.html',
                'https://example.com/view/season4/episode3.html',
                // ... más URLs para otros capítulos de la temporada 4
            ]
        };

        // URLs de descarga de los episodios por temporada
        const urlsDescarga = {
            1: [
                'https://example.com/download/season1/episode1.mp4',
                'https://example.com/download/season1/episode2.mp4',
                'https://example.com/download/season1/episode3.mp4',
                // ... más URLs para otros capítulos de la temporada 1
            ],
            2: [
                'https://example.com/download/season2/episode1.mp4',
                'https://example.com/download/season2/episode2.mp4',
                'https://example.com/download/season2/episode3.mp4',
                // ... más URLs para otros capítulos de la temporada 2
            ],
            3: [
                'https://example.com/download/season3/episode1.mp4',
                'https://example.com/download/season3/episode2.mp4',
                'https://example.com/download/season3/episode3.mp4',
                // ... más URLs para otros capítulos de la temporada 3
            ],
            4: [
                'https://example.com/download/season4/episode1.mp4',
                'https://example.com/download/season4/episode2.mp4',
                'https://example.com/download/season4/episode3.mp4',
                // ... más URLs para otros capítulos de la temporada 4
            ]
        };

        function saveProgress(season, episode, url) {
            localStorage.setItem('lastWatchedEpisode', JSON.stringify({season, episode, url}));
        }

        function loadProgress() {
            const savedData = localStorage.getItem('lastWatchedEpisode');
            return savedData ? JSON.parse(savedData) : null;
        }

        function highlightSavedEpisode() {
            const savedData = loadProgress();
            if (savedData) {
                episodeButton.textContent = savedData.episode;
                videoPlayer.src = savedData.url;
                const episodeIndex = capítulos[savedData.season - 1].episodios.indexOf(savedData.episode);
                if (episodeIndex !== -1) {
                    downloadButton.textContent = `Descargar ${savedData.episode}`;
                    downloadButton.onclick = () => {
                        window.open(urlsDescarga[savedData.season][episodeIndex] || '#', '_blank');
                    };
                    document.querySelectorAll('.episode-item').forEach(item => {
                        if (item.textContent === savedData.episode) {
                            item.classList.add('selected');
                        }
                    });
                }
                document.querySelectorAll('.season-item').forEach(item => {
                    if (parseInt(item.dataset.season) === savedData.season) {
                        item.classList.add('selected');
                        item.click(); // Abre la temporada guardada
                    }
                });
            }
        }

        seasonItems.forEach(item => {
            item.addEventListener('click', () => {
                const season = parseInt(item.dataset.season);
                episodeList.innerHTML = ''; // Limpia la lista de capítulos

                const episodiosTemporada = capítulos.find(cap => cap.temporada === season);

                if (episodiosTemporada) {
                    episodiosTemporada.episodios.forEach((episodio, index) => {
                        const episodeItem = document.createElement('div');
                        episodeItem.classList.add('episode-item');
                        episodeItem.textContent = episodio;

                        let label = 'SUB';
                        if (
                            (season === 1 && index < 26) || // Temporada 1, episodio 10 en ES
                            (season === 2 && index < 18) ||   // Temporada 2, primeros 5 episodios en ES
                            (season === 3 && index < 11) ||   // Temporada 3, primeros 2 episodios en ES
                            (season === 4 && index < 8)      // Temporada 4, primeros 7 episodios en ES
                        ) {
                            label = 'ES';
                        }
                        episodeItem.setAttribute('data-label', label);

                        episodeItem.addEventListener('click', () => {
                            let urlVisualización = urlsVisualización[season][index];
                            let urlDescarga = urlsDescarga[season][index];
                            
                            videoPlayer.src = urlVisualización;
                            
                            // Desplaza hacia arriba al video
                            videoSection.scrollIntoView();

                            // Guarda la temporada y el episodio seleccionado con su URL
                            saveProgress(season, episodio, urlVisualización);

                            // Cambia el texto del botón al capítulo seleccionado
                            episodeButton.textContent = episodio;

                            // Cambia el texto del botón de subtítulos según el idioma
                            subtitlesButton.textContent = label === 'ES' ? 'Español' : 'Subtitulado';

                            // Actualiza el botón de descarga
                            downloadButton.textContent = `Descargar ${episodio}`;
                            downloadButton.onclick = () => {
                                window.open(urlDescarga, '_blank');
                            };

                            // Cambia el color del episodio seleccionado
                            document.querySelectorAll('.episode-item').forEach(el => el.classList.remove('selected'));
                            episodeItem.classList.add('selected');
                        });
                        episodeList.appendChild(episodeItem);
                    });
                    episodesSection.style.display = 'block'; // Muestra la sección de capítulos
                    document.querySelectorAll('.season-item').forEach(el => el.classList.remove('selected'));
                    item.classList.add('selected'); // Marca la temporada seleccionada
                }
            });
        });

        window.onload = function() {
            highlightSavedEpisode(); // Resalta el episodio guardado al cargar la página
        };
    </script>
</body>
</html>
